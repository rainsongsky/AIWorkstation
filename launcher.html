<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ComfyUI - 元极AI工作站</title>
    <style>
      /* 内嵌样式以确保在开发模式下正常显示 */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #1a1a1a;
        --bg-secondary: #242424;
        --bg-tertiary: #2d2d2d;
        --bg-hover: #333333;
        --text-primary: #e0e0e0;
        --text-secondary: #a0a0a0;
        --text-tertiary: #808080;
        --accent-primary: #4a9eff;
        --accent-hover: #5cacff;
        --border-color: #3a3a3a;
        --success-color: #4caf50;
        --titlebar-height: 32px;
        --sidebar-left-width: 60px;
        --sidebar-right-width: 280px;
        --statusbar-height: 32px;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        overflow: hidden;
        user-select: none;
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .titlebar {
        height: var(--titlebar-height);
        background-color: #0f0f0f;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
      }

      .titlebar-drag-region {
        flex: 1;
        height: 100%;
        display: flex;
        align-items: center;
        padding-left: 12px;
        -webkit-app-region: drag;
      }

      .titlebar-title {
        font-size: 12px;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .titlebar-controls {
        display: flex;
        height: 100%;
        -webkit-app-region: no-drag;
      }

      .titlebar-button {
        width: 46px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        color: var(--text-primary);
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .titlebar-button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .titlebar-button.titlebar-close:hover {
        background-color: #e81123;
        color: white;
      }

      /* Tab 栏样式 */
      .tab-bar {
        height: 40px;
        background-color: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: flex-end;
        padding: 0 8px;
        flex-shrink: 0;
        overflow-x: auto;
        overflow-y: hidden;
      }

      .tab-bar::-webkit-scrollbar {
        height: 0;
      }

      .tab {
        height: 36px;
        min-width: 120px;
        max-width: 200px;
        background-color: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        display: flex;
        align-items: center;
        padding: 0 12px;
        margin-right: 4px;
        cursor: pointer;
        position: relative;
        transition: background-color 0.2s;
        user-select: none;
      }

      .tab:hover {
        background-color: var(--bg-hover);
      }

      .tab.active {
        background-color: var(--bg-primary);
        border-color: var(--border-color);
        border-bottom: 1px solid var(--bg-primary);
        margin-bottom: -1px;
      }

      .tab-icon {
        width: 16px;
        height: 16px;
        margin-right: 8px;
        flex-shrink: 0;
        color: var(--text-secondary);
      }

      .tab.active .tab-icon {
        color: var(--accent-primary);
      }

      .tab-title {
        flex: 1;
        font-size: 13px;
        color: var(--text-secondary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tab.active .tab-title {
        color: var(--text-primary);
        font-weight: 500;
      }

      .tab-close {
        width: 16px;
        height: 16px;
        margin-left: 8px;
        flex-shrink: 0;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition:
          opacity 0.2s,
          background-color 0.2s;
      }

      .tab:hover .tab-close {
        opacity: 1;
      }

      .tab-close:hover {
        background-color: var(--bg-hover);
      }

      .tab-new {
        width: 36px;
        height: 36px;
        min-width: 36px;
        background-color: transparent;
        border: none;
        border-radius: 8px 8px 0 0;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-secondary);
        transition:
          background-color 0.2s,
          color 0.2s;
      }

      .tab-new:hover {
        background-color: var(--bg-hover);
        color: var(--text-primary);
      }

      /* Tab 内容容器 */
      .tab-content-container {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
      }

      .tab-content {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: none;
        flex-direction: column;
      }

      .tab-content.active {
        display: flex;
      }

      .main-container {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      .sidebar-left {
        width: var(--sidebar-left-width);
        background-color: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px 0;
        flex-shrink: 0;
      }

      .launch-button {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .launch-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      .launch-button:active {
        transform: translateY(0);
      }

      .launch-button.loading {
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .menu-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: auto;
      }

      .menu-item {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition:
          background-color 0.2s,
          color 0.2s;
      }

      .menu-item:hover {
        background-color: var(--bg-hover);
        color: var(--text-primary);
      }

      .sidebar-bottom {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
      }

      .content-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        background-color: var(--bg-primary);
      }

      /* 加载提示样式 */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .loading-overlay.show {
        display: flex;
      }

      .loading-content {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 32px 48px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      }

      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid var(--bg-hover);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: 16px;
        color: var(--text-primary);
        margin-bottom: 8px;
      }

      .loading-subtext {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .banner {
        height: 200px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 32px;
        overflow: hidden;
      }

      .banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image:
          linear-gradient(45deg, rgba(255, 255, 255, 0.05) 25%, transparent 25%),
          linear-gradient(-45deg, rgba(255, 255, 255, 0.05) 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, rgba(255, 255, 255, 0.05) 75%),
          linear-gradient(-45deg, transparent 75%, rgba(255, 255, 255, 0.05) 75%);
        background-size: 40px 40px;
        background-position:
          0 0,
          0 20px,
          20px -20px,
          -20px 0px;
        opacity: 0.3;
      }

      .banner-content {
        position: relative;
        z-index: 1;
      }

      .banner-title {
        font-size: 32px;
        font-weight: 700;
        color: white;
        margin-bottom: 4px;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .banner-subtitle {
        font-size: 24px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin-bottom: 8px;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .banner-description {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
      }

      .banner-credit {
        position: absolute;
        bottom: 12px;
        right: 16px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.7);
        z-index: 1;
      }

      .folders-section {
        padding: 24px 32px;
      }

      .section-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
      }

      .folders-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .folder-card {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition:
          background-color 0.2s,
          border-color 0.2s,
          transform 0.1s;
        text-align: left;
      }

      .folder-card:hover {
        background-color: var(--bg-tertiary);
        border-color: var(--accent-primary);
        transform: translateY(-2px);
      }

      .folder-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background-color: rgba(74, 158, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent-primary);
        flex-shrink: 0;
      }

      .folder-info {
        flex: 1;
        min-width: 0;
      }

      .folder-name {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
      }

      .folder-path {
        font-size: 12px;
        color: var(--text-tertiary);
        font-family: 'Consolas', 'Monaco', monospace;
      }

      .folder-arrow {
        color: var(--text-tertiary);
        flex-shrink: 0;
      }

      .sidebar-right {
        width: var(--sidebar-right-width);
        background-color: var(--bg-secondary);
        border-left: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
      }

      .sidebar-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        padding: 16px;
        border-bottom: 1px solid var(--border-color);
      }

      .announcements {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
      }

      .announcement-item {
        background-color: var(--bg-tertiary);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
        font-size: 12px;
        line-height: 1.6;
        color: var(--text-secondary);
        border-left: 3px solid var(--accent-primary);
      }

      .announcement-item:last-child {
        margin-bottom: 0;
      }

      .statusbar {
        height: var(--statusbar-height);
        background-color: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 16px;
        font-size: 11px;
        flex-shrink: 0;
      }

      .statusbar-left {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .status-item {
        display: flex;
        gap: 6px;
        align-items: center;
      }

      .status-label {
        color: var(--text-tertiary);
      }

      .status-value {
        color: var(--text-secondary);
        font-weight: 500;
      }

      .statusbar-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .activation-badge {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        background-color: rgba(76, 175, 80, 0.1);
        border: 1px solid rgba(76, 175, 80, 0.3);
        border-radius: 4px;
        font-size: 11px;
        color: var(--success-color);
      }

      .activation-platform {
        font-weight: 600;
      }

      .start-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        background-color: var(--accent-primary);
        border: none;
        border-radius: 4px;
        color: white;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .start-button:hover {
        background-color: var(--accent-hover);
      }

      .start-button.disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-primary);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--bg-hover);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #444444;
      }
    </style>
  </head>
  <body>
    <!-- 加载提示遮罩 -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">正在启动 ComfyUI...</div>
        <div class="loading-subtext" id="loading-subtext">请稍候，这可能需要几秒钟</div>
      </div>
    </div>

    <!-- 自定义标题栏 -->
    <!-- <div class="titlebar" id="titlebar">
      <div class="titlebar-drag-region">
        <span class="titlebar-title">元极AI工作站 0.1.0</span>
      </div>
      <div class="titlebar-controls">
        <button class="titlebar-button" id="minimize-btn" aria-label="最小化">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <rect x="0" y="5" width="12" height="2" fill="currentColor" />
          </svg>
        </button>
        <button class="titlebar-button" id="maximize-btn" aria-label="最大化">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <rect x="0" y="0" width="12" height="12" stroke="currentColor" stroke-width="1.5" fill="none" />
          </svg>
        </button>
        <button class="titlebar-button titlebar-close" id="close-btn" aria-label="关闭">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M1 1 L11 11 M11 1 L1 11" stroke="currentColor" stroke-width="1.5" />
          </svg>
        </button>
      </div>
    </div> -->

    <!-- Tab 栏 -->
    <div class="tab-bar">
      <div class="tab active" data-tab-id="home">
        <svg
          class="tab-icon"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
        <span class="tab-title">首页</span>
        <div class="tab-close" style="display: none">
          <svg width="12" height="12" viewBox="0 0 12 12">
            <path d="M1 1 L11 11 M11 1 L1 11" stroke="currentColor" stroke-width="1.5" />
          </svg>
        </div>
      </div>
      <button class="tab-new" title="新建标签">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
      </button>
    </div>

    <!-- Tab 内容容器 -->
    <div class="tab-content-container">
      <!-- 首页 Tab 内容 -->
      <div class="tab-content active" data-tab-id="home">
        <!-- 主要内容区域 -->
        <div class="main-container">
          <!-- 左侧边栏 -->
          <div class="sidebar-left">
            <!-- 启动按钮 -->
            <button class="launch-button" id="launch-btn" title="一键启动">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z" />
              </svg>
            </button>

            <!-- 菜单项 -->
            <div class="menu-items">
              <button class="menu-item" data-action="advanced" title="高级选项">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" />
                  <path d="M9 3v18M15 3v18" />
                </svg>
              </button>
              <button class="menu-item" data-action="troubleshoot" title="疑难解答">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
                  />
                </svg>
              </button>
              <button class="menu-item" data-action="version" title="版本管理">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12 6 12 12 16 14" />
                </svg>
              </button>
            </div>

            <!-- 底部菜单 -->
            <div class="sidebar-bottom">
              <button class="menu-item" data-action="community" title="交流群">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                  <circle cx="9" cy="7" r="4" />
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
              </button>
              <button class="menu-item" data-action="settings" title="设置">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3" />
                  <path d="M12 1v6m0 6v6" />
                </svg>
              </button>
            </div>
          </div>

          <!-- 中间内容区域 -->
          <div class="content-main">
            <!-- Banner 区域 -->
            <div class="banner">
              <div class="banner-content">
                <h1 class="banner-title">元极AI工作站</h1>
                <h2 class="banner-subtitle">让商业级视觉创作触手可及</h2>
                <p class="banner-description">从工具到方法，一站式AI商业视觉创作</p>
              </div>
              <div class="banner-credit">Created by yuanjilab.com</div>
            </div>

            <!-- 文件夹区域 -->
            <div class="folders-section">
              <h3 class="section-title">文件夹</h3>
              <div class="folders-grid">
                <button class="folder-card" data-folder="root">
                  <div class="folder-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                    </svg>
                  </div>
                  <div class="folder-info">
                    <div class="folder-name">根目录</div>
                  </div>
                  <div class="folder-arrow">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6" />
                    </svg>
                  </div>
                </button>

                <button class="folder-card" data-folder="custom_nodes">
                  <div class="folder-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3" />
                      <circle cx="12" cy="5" r="2" />
                      <circle cx="12" cy="19" r="2" />
                      <circle cx="5" cy="12" r="2" />
                      <circle cx="19" cy="12" r="2" />
                    </svg>
                  </div>
                  <div class="folder-info">
                    <div class="folder-name">自定义节点</div>
                    <div class="folder-path">custom_nodes</div>
                  </div>
                  <div class="folder-arrow">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6" />
                    </svg>
                  </div>
                </button>

                <button class="folder-card" data-folder="input">
                  <div class="folder-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                      <circle cx="8.5" cy="8.5" r="1.5" />
                      <polyline points="21 15 16 10 5 21" />
                    </svg>
                  </div>
                  <div class="folder-info">
                    <div class="folder-name">输入图片</div>
                    <div class="folder-path">input</div>
                  </div>
                  <div class="folder-arrow">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6" />
                    </svg>
                  </div>
                </button>

                <button class="folder-card" data-folder="output">
                  <div class="folder-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                      <polyline points="7 10 12 15 17 10" />
                      <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                  </div>
                  <div class="folder-info">
                    <div class="folder-name">输出图片</div>
                    <div class="folder-path">output</div>
                  </div>
                  <div class="folder-arrow">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6" />
                    </svg>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- 右侧边栏 - 公告 -->
          <div class="sidebar-right">
            <h3 class="sidebar-title">公告</h3>
            <div class="announcements">
              <div class="announcement-item">
                <p>11/11 工作流上新，道新增“多图融合”、“万物替换”、“去AI感”、“高清放大”。</p>
              </div>
              <div class="announcement-item">
                <p>11/10 元极AI工作站0.1.0正式发布，欢迎试用！</p>
              </div>
            </div>
          </div>
        </div>
        <!-- end main-container -->
      </div>
      <!-- end tab-content home -->
    </div>
    <!-- end tab-content-container -->

    <!-- 底部状态栏 -->
    <div class="statusbar">
      <div class="statusbar-left">
        <div class="status-item">
          <span class="status-label">启动器版本:</span>
          <span class="status-value" id="launcher-version">0.1.0 Build 001</span>
        </div>
        <div class="status-item">
          <span class="status-label">配置文件版本:</span>
          <span class="status-value" id="config-version">2025-11-11 11:11</span>
        </div>
        <div class="status-item">
          <span class="status-label">ComfyUI 版本:</span>
          <span class="status-value" id="comfyui-version">加载中...</span>
        </div>
      </div>
      <div class="statusbar-right">
        <div class="activation-badge">
          <span>激活</span>
          <span class="activation-platform" id="activation-platform">Windows</span>
        </div>
        <button class="start-button" id="start-button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 8l6 4-6 4z" />
          </svg>
          <span id="start-button-text">一键启动</span>
        </button>
      </div>
    </div>

    <script>
      // 启动器渲染进程逻辑 - 内嵌版本
      class LauncherApp {
        constructor() {
          this.launchButton = document.getElementById('launch-btn');
          this.startButton = document.getElementById('start-button');
          this.startButtonText = document.getElementById('start-button-text');
          this.isLaunching = false;
          this.tabs = [];
          this.activeTabId = 'home';
          this.init();
        }

        init() {
          this.setupTabs();
          this.setupTitleBarControls();
          this.setupLaunchButton();
          this.setupFolderButtons();
          this.setupMenuButtons();
          this.loadVersionInfo();

          // 通知主进程渲染器已就绪
          const electronAPI = window.electronAPI;
          if (electronAPI && electronAPI.sendReady) {
            electronAPI.sendReady();
          }
        }

        setupTabs() {
          // 设置 tab 点击事件
          const tabElements = document.querySelectorAll('.tab');
          tabElements.forEach((tab) => {
            tab.addEventListener('click', (e) => {
              // 如果点击的是关闭按钮，不切换 tab
              if (e.target.closest('.tab-close')) {
                return;
              }
              const tabId = tab.getAttribute('data-tab-id');
              this.switchTab(tabId);
            });

            // 设置关闭按钮事件
            const closeBtn = tab.querySelector('.tab-close');
            if (closeBtn) {
              closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const tabId = tab.getAttribute('data-tab-id');
                this.closeTab(tabId);
              });
            }
          });

          // 设置新建 tab 按钮
          const newTabBtn = document.querySelector('.tab-new');
          if (newTabBtn) {
            newTabBtn.addEventListener('click', () => {
              this.createNewTab();
            });
          }
        }

        switchTab(tabId) {
          // 移除所有 active 类
          document.querySelectorAll('.tab').forEach((tab) => {
            tab.classList.remove('active');
          });
          document.querySelectorAll('.tab-content').forEach((content) => {
            content.classList.remove('active');
          });

          // 添加 active 类到选中的 tab
          const selectedTab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
          const selectedContent = document.querySelector(`.tab-content[data-tab-id="${tabId}"]`);

          if (selectedTab) selectedTab.classList.add('active');
          if (selectedContent) selectedContent.classList.add('active');

          this.activeTabId = tabId;
        }

        closeTab(tabId) {
          // 首页 tab 不能关闭
          if (tabId === 'home') {
            return;
          }

          const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
          const content = document.querySelector(`.tab-content[data-tab-id="${tabId}"]`);

          if (tab) tab.remove();
          if (content) content.remove();

          // 如果关闭的是当前激活的 tab，切换到首页
          if (this.activeTabId === tabId) {
            this.switchTab('home');
          }
        }

        createNewTab(options = {}) {
          const { id = `tab-${Date.now()}`, title = '新标签页', icon = null, url = null, closable = true } = options;

          // 检查是否已存在相同 id 的 tab
          const existingTab = document.querySelector(`.tab[data-tab-id="${id}"]`);
          if (existingTab) {
            this.switchTab(id);
            return;
          }

          // 创建 tab 元素
          const tabBar = document.querySelector('.tab-bar');
          const newTabBtn = document.querySelector('.tab-new');

          const tab = document.createElement('div');
          tab.className = 'tab';
          tab.setAttribute('data-tab-id', id);

          // 图标
          if (icon) {
            const iconElement = document.createElement('div');
            iconElement.className = 'tab-icon';
            iconElement.innerHTML = icon;
            tab.appendChild(iconElement);
          }

          // 标题
          const titleElement = document.createElement('span');
          titleElement.className = 'tab-title';
          titleElement.textContent = title;
          tab.appendChild(titleElement);

          // 关闭按钮
          if (closable) {
            const closeBtn = document.createElement('div');
            closeBtn.className = 'tab-close';
            closeBtn.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12">
              <path d="M1 1 L11 11 M11 1 L1 11" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          `;
            closeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              this.closeTab(id);
            });
            tab.appendChild(closeBtn);
          }

          // 添加点击事件
          tab.addEventListener('click', () => {
            this.switchTab(id);
          });

          // 插入到新建按钮之前
          tabBar.insertBefore(tab, newTabBtn);

          // 创建 tab 内容
          const contentContainer = document.querySelector('.tab-content-container');
          const content = document.createElement('div');
          content.className = 'tab-content';
          content.setAttribute('data-tab-id', id);

          if (url) {
            // 如果有 URL，创建 webview
            // 创建一个 wrapper 容器来确保 webview 正确布局
            const webviewWrapper = document.createElement('div');
            webviewWrapper.style.width = '100%';
            webviewWrapper.style.height = '100%';
            webviewWrapper.style.display = 'flex';
            webviewWrapper.style.flexDirection = 'column';
            webviewWrapper.style.overflow = 'hidden';

            const webview = document.createElement('webview');
            webview.setAttribute('src', url);
            webview.setAttribute('partition', 'persist:comfyui');
            webview.setAttribute('allowpopups', '');
            webview.setAttribute('webpreferences', 'contextIsolation=true');
            webview.style.width = '100%';
            webview.style.height = '100%';
            webview.style.border = 'none';
            webview.style.flex = '1';
            webview.style.minHeight = '0';

            // 添加加载事件监听
            webview.addEventListener('did-start-loading', () => {
              console.log('[DEBUG] Webview started loading:', url);
            });

            webview.addEventListener('did-stop-loading', () => {
              console.log('[DEBUG] Webview finished loading:', url);
            });

            webview.addEventListener('did-fail-load', (e) => {
              console.error('[DEBUG] Webview failed to load:', e);
              console.error('[DEBUG] Error code:', e.errorCode, 'Error description:', e.errorDescription);
            });

            webview.addEventListener('console-message', (e) => {
              console.log('[WEBVIEW LOG]', e.message);
            });

            webviewWrapper.appendChild(webview);
            content.appendChild(webviewWrapper);
          } else {
            // 默认空内容
            content.innerHTML = '<div style="padding: 20px; color: var(--text-secondary);">标签页内容</div>';
          }

          contentContainer.appendChild(content);

          // 切换到新 tab
          this.switchTab(id);
        }

        setupTitleBarControls() {
          const minimizeBtn = document.getElementById('minimize-btn');
          const maximizeBtn = document.getElementById('maximize-btn');
          const closeBtn = document.getElementById('close-btn');
          const electronAPI = window.electronAPI;

          if (minimizeBtn) {
            minimizeBtn.addEventListener('click', async () => {
              if (electronAPI && electronAPI.Launcher) {
                await electronAPI.Launcher.windowControl('minimize');
              }
            });
          }

          if (maximizeBtn) {
            maximizeBtn.addEventListener('click', async () => {
              if (electronAPI && electronAPI.Launcher) {
                await electronAPI.Launcher.windowControl('maximize');
              }
            });
          }

          if (closeBtn) {
            closeBtn.addEventListener('click', async () => {
              if (electronAPI && electronAPI.Launcher) {
                await electronAPI.Launcher.windowControl('close');
              }
            });
          }
        }

        setupLaunchButton() {
          // 左侧边栏的启动按钮
          if (this.launchButton) {
            this.launchButton.addEventListener('click', () => {
              this.handleLaunch();
            });
          }

          // 右下角状态栏的启动按钮
          if (this.startButton) {
            this.startButton.addEventListener('click', () => {
              this.handleLaunch();
            });
          }
        }

        setupFolderButtons() {
          const folderButtons = document.querySelectorAll('.folder-card');
          const electronAPI = window.electronAPI;

          folderButtons.forEach((button) => {
            button.addEventListener('click', async () => {
              const folderKey = button.getAttribute('data-folder');
              if (folderKey && electronAPI && electronAPI.Launcher && electronAPI.Launcher.openFolder) {
                try {
                  await electronAPI.Launcher.openFolder(folderKey);
                } catch (error) {
                  console.error(`Failed to open folder: ${folderKey}`, error);
                }
              }
            });
          });
        }

        setupMenuButtons() {
          const menuButtons = document.querySelectorAll('.menu-item');

          menuButtons.forEach((button) => {
            button.addEventListener('click', () => {
              const action = button.getAttribute('data-action');
              this.handleMenuAction(action);
            });
          });
        }

        handleMenuAction(action) {
          if (!action) return;
          console.log(`Menu action: ${action}`);

          switch (action) {
            case 'advanced':
              console.log('打开高级选项');
              break;
            case 'troubleshoot':
              console.log('打开疑难解答');
              break;
            case 'version':
              console.log('打开版本管理');
              break;
            case 'community':
              console.log('打开交流群');
              break;
            case 'settings':
              console.log('打开设置');
              break;
            default:
              console.log(`Unknown action: ${action}`);
          }
        }

        showLoadingOverlay(text = '正在启动 元极AI工作站...', subtext = '请稍候，这可能需要几秒钟') {
          const overlay = document.getElementById('loading-overlay');
          const textElement = document.getElementById('loading-text');
          const subtextElement = document.getElementById('loading-subtext');

          if (textElement) textElement.textContent = text;
          if (subtextElement) subtextElement.textContent = subtext;
          if (overlay) overlay.classList.add('show');
        }

        hideLoadingOverlay() {
          const overlay = document.getElementById('loading-overlay');
          if (overlay) overlay.classList.remove('show');
        }

        async handleLaunch() {
          if (this.isLaunching) {
            console.log('Already launching...');
            return;
          }

          this.isLaunching = true;
          this.setLaunchingState(true);
          this.showLoadingOverlay('正在启动 元极AI工作站...', '请稍候，服务器正在初始化');
          const electronAPI = window.electronAPI;

          try {
            if (electronAPI && electronAPI.Launcher && electronAPI.Launcher.startComfyUI) {
              console.log('[DEBUG] Starting ComfyUI...');

              // 启动 ComfyUI 并获取 URL with timeout
              const startPromise = electronAPI.Launcher.startComfyUI();
              const timeoutPromise = new Promise((_, reject) =>
                setTimeout(() => reject(new Error('Timeout waiting for ComfyUI to start')), 30000)
              );

              const result = await Promise.race([startPromise, timeoutPromise]);
              console.log('[DEBUG] ComfyUI start result:', result);
              console.log('[DEBUG] Result type:', typeof result);
              console.log('[DEBUG] Result.url:', result ? result.url : 'no result');

              // 立即隐藏加载提示
              console.log('[DEBUG] About to hide loading overlay...');
              this.hideLoadingOverlay();
              console.log('[DEBUG] Loading overlay hidden');

              // 创建新的 ComfyUI tab
              if (result && result.url) {
                console.log('[DEBUG] Creating tab with URL:', result.url);
                this.createNewTab({
                  id: 'comfyui',
                  title: 'ComfyUI',
                  icon: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="7" height="7"/>
                  <rect x="14" y="3" width="7" height="7"/>
                  <rect x="14" y="14" width="7" height="7"/>
                  <rect x="3" y="14" width="7" height="7"/>
                </svg>`,
                  url: result.url,
                  closable: true,
                });

                // 启动成功，更新按钮状态
                this.setLaunchingState(false);
                this.setButtonRunning();
              } else {
                console.error('[DEBUG] No valid result or URL. Result:', result);
                alert('ComfyUI 启动成功，但未返回 URL。请检查控制台日志。');
                this.setLaunchingState(false);
                this.resetButtonText();
              }

              this.isLaunching = false;
            } else {
              console.error('electronAPI.Launcher.startComfyUI is not available');
              this.hideLoadingOverlay();
              this.setLaunchingState(false);
              this.resetButtonText();
              this.isLaunching = false;
            }
          } catch (error) {
            console.error('Failed to start ComfyUI:', error);
            console.error('[DEBUG] Error details:', error.message, error.stack);
            alert('启动 ComfyUI 失败: ' + error.message);
            this.hideLoadingOverlay();
            this.setLaunchingState(false);
            this.resetButtonText();
            this.isLaunching = false;
          }
        }

        setLaunchingState(isLaunching) {
          if (isLaunching) {
            this.launchButton.classList.add('loading');
            this.launchButton.disabled = true;
            this.startButton.classList.add('disabled');
            this.startButton.disabled = true;
            this.startButtonText.textContent = '运行中...';
          } else {
            this.launchButton.classList.remove('loading');
            this.launchButton.disabled = false;
            this.startButton.classList.remove('disabled');
            this.startButton.disabled = false;
            // 不在这里改变文字，由调用者决定
          }
        }

        setButtonRunning() {
          this.startButtonText.textContent = '运行中';
        }

        resetButtonText() {
          this.startButtonText.textContent = '一键启动';
        }

        loadVersionInfo() {
          try {
            const electronAPI = window.electronAPI;

            // 获取 ComfyUI 版本
            if (electronAPI && electronAPI.getComfyUIVersion) {
              const version = electronAPI.getComfyUIVersion();
              const versionElement = document.getElementById('comfyui-version');
              if (versionElement) {
                versionElement.textContent = version || '未知';
              }
            }

            // 获取平台信息
            if (electronAPI && electronAPI.getPlatform) {
              const platform = electronAPI.getPlatform();
              const platformElement = document.getElementById('activation-platform');
              if (platformElement) {
                const platformMap = {
                  darwin: 'macOS',
                  win32: 'Windows',
                  linux: 'Linux',
                };
                platformElement.textContent = platformMap[platform] || platform;
              }
            }
          } catch (error) {
            console.error('Failed to load version info:', error);
          }
        }
      }

      // 当 DOM 加载完成后初始化应用
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          new LauncherApp();
        });
      } else {
        new LauncherApp();
      }
    </script>
  </body>
</html>
